{{extend 'layout.html'}}

{{block head}}
<script src="{{=URL('static', 'js/vue.js')}}"></script>
<script>
    //posts
    var add_post_url = "{{=URL('api', 'add_post', user_signature=True)}}";
    var edit_post_url = "{{=URL('api', 'edit_post', user_signature=True)}}";
    var get_post_list_url = "{{=URL('api', 'get_post_list')}}";
    //replies
    var add_reply_url = "{{=URL('api', 'add_reply', user_signature=True)}}";
    var edit_reply_url = "{{=URL('api', 'edit_reply', user_signature=True)}}";
    var get_reply_list_url = "{{=URL('api', 'get_reply_list')}}";
    // thumbs.
    var thumb_count_url = "{{=URL('api', 'all_thumbs')}}";
    var thumb_up_url = "{{=URL('api', 'thumb_up', user_signature=True)}}";
    var thumb_down_url = "{{=URL('api', 'thumb_down', user_signature=True)}}";
    //stars
    var set_stars_url = "{{=URL('api', 'set_stars', user_signature=True)}}";
    var get_all_stars_url = "{{=URL('api', 'all_stars')}}";
    //user misc
    var is_logged_in = {{='false' if auth.user is None else 'true'}};
    var curr_user = "{{=auth.user.email if auth.user else None}}";
</script>
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
{{end}}


    <div id="myCarousel" class="carousel slide" data-ride="carousel">
      <ol class="carousel-indicators">
        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
        <li data-target="#myCarousel" data-slide-to="1"></li>
        <li data-target="#myCarousel" data-slide-to="2"></li>
      </ol>
      <div class="carousel-inner" role="listbox">
        <div class="carousel-item active">
          <img class="first-slide" src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="First slide">
          <div class="container">
            <div class="carousel-caption d-none d-md-block text-left">
              <h1>Example headline.</h1>
              <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
              <p><a class="btn btn-lg btn-primary" href="#" role="button">Sign up today</a></p>
            </div>
          </div>
        </div>
        <div class="carousel-item">
          <img class="second-slide" src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
          <div class="container">
            <div class="carousel-caption d-none d-md-block">
              <h1>Another example headline.</h1>
              <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
              <p><a class="btn btn-lg btn-primary" href="#" role="button">Learn more</a></p>
            </div>
          </div>
        </div>
        <div class="carousel-item">
          <img class="third-slide" src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Third slide">
          <div class="container">
            <div class="carousel-caption d-none d-md-block text-right">
              <h1>One more for good measure.</h1>
              <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
              <p><a class="btn btn-lg btn-primary" href="#" role="button">Browse gallery</a></p>
            </div>
          </div>
        </div>
      </div>
      <a class="carousel-control-prev" href="#myCarousel" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="carousel-control-next" href="#myCarousel" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>


    <!-- Marketing messaging and featurettes
    ================================================== -->
    <!-- Wrap the rest of the page in another container to center all the content. -->

    <div class="container marketing">

      <!-- Three columns of text below the carousel -->
      <div class="row">
        <div class="col-lg-4">
          <img class="rounded-circle" src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Generic placeholder image" width="140" height="140">
          <h2>Japanese food</h2>
          <p> This could be one type of restaurant</p>
          <p><a class="btn btn-secondary" href="#" role="button">Post My restaurant</a></p>
        </div><!-- /.col-lg-4 -->
        <div class="col-lg-4">
          <img class="rounded-circle" src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Generic placeholder image" width="140" height="140">
          <h2>Chinese food</h2>
          <p> This could be one type of restaurant</p>
          <p><a class="btn btn-secondary" href="#" role="button">Post My restaurant</a></p>
        </div><!-- /.col-lg-4 -->
        <div class="col-lg-4">
          <img class="rounded-circle" src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Generic placeholder image" width="140" height="140">
          <h2>Western food</h2>
          <p> This could be one type of restaurant.</p>
          <p><a class="btn btn-secondary" href="#" role="button">Post My restaurant</a></p>
        </div><!-- /.col-lg-4 -->
      </div><!-- /.row -->


      <!-- START THE FEATURETTES -->

      <hr class="featurette-divider">

      <div class="row featurette">
        <div class="col-md-7">
          <h2 class="featurette-heading">First featurette heading. <span class="text-muted">It'll blow your mind.</span></h2>
          <p class="lead">Donec ullamcorper nulla non metus auctor fringilla. Vestibulum id ligula porta felis euismod semper. Praesent commodo cursus magna, vel scelerisque nisl consectetur. Fusce dapibus, tellus ac cursus commodo.</p>
        </div>
        <div class="col-md-5">
          <img class="featurette-image img-fluid mx-auto" data-src="holder.js/500x500/auto" alt="Generic placeholder image">
        </div>
      </div>

      <hr class="featurette-divider">

      <div class="row featurette">
        <div class="col-md-7 push-md-5">
          <h2 class="featurette-heading">Oh yeah, it's that good. <span class="text-muted">See for yourself.</span></h2>
          <p class="lead">Donec ullamcorper nulla non metus auctor fringilla. Vestibulum id ligula porta felis euismod semper. Praesent commodo cursus magna, vel scelerisque nisl consectetur. Fusce dapibus, tellus ac cursus commodo.</p>
        </div>
        <div class="col-md-5 pull-md-7">
          <img class="featurette-image img-fluid mx-auto" data-src="holder.js/500x500/auto" alt="Generic placeholder image">
        </div>
      </div>

      <hr class="featurette-divider">

      <div class="row featurette">
        <div class="col-md-7">
          <h2 class="featurette-heading">And lastly, this one. <span class="text-muted">Checkmate.</span></h2>
          <p class="lead">Donec ullamcorper nulla non metus auctor fringilla. Vestibulum id ligula porta felis euismod semper. Praesent commodo cursus magna, vel scelerisque nisl consectetur. Fusce dapibus, tellus ac cursus commodo.</p>
        </div>
        <div class="col-md-5">
          <img class="featurette-image img-fluid mx-auto" data-src="holder.js/500x500/auto" alt="Generic placeholder image">
        </div>
      </div>

      <hr class="featurette-divider">

      <!-- /END THE FEATURETTES -->


      <!-- FOOTER -->
      <footer>
        <p class="float-right"><a href="#">Back to top</a></p>
        <p><a href="http://lacodeid.com/">lacodeid.com</a>Â© 2017 Company, Inc.</p>
      </footer>

    </div><!-- /.container -->

<div class="main_content">

    <div id="vue-div" class="display:none">
      <div id="add_post" style="display:none">
        <div v-if="show_form">
          <div class="container form_row">
            <div class="label quarter">
              Title:
            </div>
            <div class="form threequarters">
              <input v-model="form_title" placeholder="Enter the post title"/>
            </div>
          </div>
          <div class="container form_row">
            <div class="label quarter">
              Content:
            </div>
            <div class="form threequarters">
              <textarea v-model="form_content" placeholder="Enter the content of your post"></textarea>
            </div>
          </div>
          <div class="container form_row"><div class="quarter"></div>
            <div class="threequarters">
              <div class="submit">
                <button id="add-post" v-on:click="add_post">Submit</button>
              </div>
            </div>
          </div>
        </div>
        <button v-show="!show_form" v-on:click="show_form = true">Add Post <i class="fa fa-plus-circle"></i></button>
      </div>

      <!-- Message in case there are no posts. -->
      <div v-if="post_list.length === 0">There are no posts.</div>

      <!-- We display the posts. -->
      <div id="post_list">
        <div class="post_div" v-for="post in post_list">
	          <div class="post_title" v-if="!post.editing">${post.post_title}</div>
	          <textarea v-if="post.editing" v-model="post.post_title"></textarea>
	          <div class="post_content">
      			<!-- Code for star ratings. -->
                <div v-for="starr_idx in [0,1,2]">
			  	  ${rating_strings[starr_idx]}
    			    <span v-for="idx in star_indices">
        		  	  <i v-if="idx <= post.avg_ratings[starr_idx]" class="fa fa-star"></i>
        		  	  <i v-if="idx > post.avg_ratings[starr_idx]" class="fa fa-star-o"></i>
    			    </span>
				</div>
				<!-- Code for star ratings end. -->
	          	<div v-if="!post.editing">
	          	  <div>${post.post_content}</div>
	          	    <div class="start-edit" v-if="post.editable">
                  	  <button id="edit" v-on:click="edit_post(post._idx)">Edit <i class="fa fa-pencil-square-o"></i></button>
              	  </div>
	          	</div>
	          	<div v-if="post.editing">
	          	  <textarea v-model="post.post_content"></textarea>
	          	  <div class="editing">
                  <button id="save-edit" v-on:click="save_edit(post._idx)">Save</button>
              	  </div>
	          	</div>
	     	  </div>
	          <div class="attributes">

              <!-- Code for Replies. -->
              <div class="replies_div">
                <div v-if="post.show_reply">
                  <button v-on:click="show_reply_toggle(post._idx)">Hide Reviews</button>
                  <button v-if="is_logged_in" v-show="!post.replying" v-on:click="post.replying = true">Add Review <i class="fa fa-plus-circle"></i></button>
                  <div v-if="post.replying">
                    <div class="container form_row">
                      <div class="form">
                        <textarea v-model="post.reply_content" placeholder="Enter the content of your reply"></textarea>
                        And your ratings:
                        <!-- Code for star ratings. -->
                        <div v-for="starr_idx in [0,1,2]">
    				  	  ${rating_strings[starr_idx]}
          			  	  <span v-on:mouseout="new_reply_stars_out(post._idx)">
            			    <span v-on:mouseover="new_reply_stars_over(post._idx, starr_idx, idx)"
                  		  	  	  v-on:click="new_reply_set_stars(post._idx, starr_idx, idx)"
                  		  	  	  v-for="idx in star_indices">
                		  	  <i v-if="idx <= post._display_ratings[starr_idx]" class="fa fa-star"></i>
                		  	  <i v-if="idx > post._display_ratings[starr_idx]" class="fa fa-star-o"></i>
            			    </span>
          				  </span>
      					</div>
      					<!-- Code for star ratings end. -->
                      </div>
                    </div>
                    <div class="container form_row">
                      <div class="submit">
                        <button id="add-reply" v-on:click="add_reply(post._idx)">Submit</button>
                      </div>
                    </div>
                  </div>

                  <!-- Message in case there are no replies. -->
                  <div v-if="post.reply_list.length === 0">There are no reviews.</div>

                  <!-- We display the replies. -->
                  <div id="reply_list">
                    <span v-if="post.reply_list.length > 0">Reviews:</span>
                    <div class="reply_div" v-for="reply in post.reply_list">
                      <div class="reply_author">Author: ${reply.reply_author}</div>
                      <div class="reply_content">
                      	<!-- Code for star ratings. -->
        				  	<div v-for="starr_idx in [0,1,2]">
        				  	  ${rating_strings[starr_idx]}
              			  	  <span v-on:mouseout="stars_out(post._idx, reply._idx)">
                			    <span v-on:mouseover="stars_over(post._idx, reply._idx, starr_idx, idx)"
                      		  	  	  v-on:click="set_stars(post._idx, reply._idx, starr_idx, idx)"
                      		  	  	  v-for="idx in star_indices">
                    		  	  <i v-if="idx <= reply._arr_num_stars[starr_idx]" class="fa fa-star"></i>
                    		  	  <i v-if="idx > reply._arr_num_stars[starr_idx]" class="fa fa-star-o"></i>
                			    </span>
              				  </span>
              				</div>
						  <!-- Code for star ratings ends. -->
                        <div v-if="!reply.editing">
                          <div>Content: ${reply.reply_content}</div>
                          <div class="start-edit" v-if="reply.editable">
                            <button id="edit" v-on:click="edit_reply(post._idx, reply._idx)">Edit <i class="fa fa-pencil-square-o"></i></button>
                          </div>
                        </div>

                        <div v-if="reply.editing">
                          <textarea v-model="reply.reply_content"></textarea>
                          <div class="editing">
                            <button id="save-edit" v-on:click="save_reply_edit(post._idx, reply._idx)">Save</button>
                          </div>
                        </div>

			            <!-- Code for Thumbs. -->
			            <div class="thumbs">
			              <span class="thumb_up">
			                <span class="toggle_tUp"
			                      v-on:mouseover="thumbUp_mouseover(post._idx, reply._idx);"
			                      v-on:click="thumbUp_click(post._idx, reply._idx);"
			                      v-on:mouseout="thumbUp_mouseout(post._idx, reply._idx);">
			                  <i v-if="reply._tUp" class="fa fa-thumbs-up"
			                  v-bind:class="{changed: reply._tUp_black === false}"></i>
			                  <i v-if="!reply._tUp" class="fa fa-thumbs-o-up"
			                  v-bind:class="{changed: reply._tUp_black === false}"></i>
			                </span>
			              </span>
			              <span class="thumb_countU"> ${reply._countU}</span>
			              <span class="thumb_down">
			                <span class="toggle_tDown"
			                      v-on:mouseover="thumbDown_mouseover(post._idx, reply._idx);"
			                      v-on:click="thumbDown_click(post._idx, reply._idx);"
			                      v-on:mouseout="thumbDown_mouseout(post._idx, reply._idx);">
			                  <i v-if="reply._tDown" class="fa fa-thumbs-down"
			                  	v-bind:class="{changed: reply._tDown_black === false}"></i>
			                  <i v-if="!reply._tDown" class="fa fa-thumbs-o-down"
			                  	v-bind:class="{changed: reply._tDown_black === false}"></i>
			                </span>
			              </span>
			              <span class="thumb_countD"> ${reply._countD}</span>
			            </div>
		              <!-- Code for Thumbs end. -->
                      </div>
                    </div>
                  </div>
                </div>
                <button v-show="!post.show_reply" v-on:click="get_replies(post._idx); show_reply_toggle(post._idx)">Add / Show Reviews</button>
              </div>
	          </div>
      </div>
    </div>

</div>

<script src="{{=URL('static', 'js/default_index.js')}}"></script>
